{{ 'section-bundle-builder.css' | asset_url | stylesheet_tag }}
{{ 'section-product-template-new.css' | asset_url | stylesheet_tag }}
{{ 'section-bundle-builder.js' | asset_url | script_tag }}
<div class="product-popup__wrapper hidden">
  <div class="close">
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" fill="none" viewBox="0 0 18 17">
      <path d="M.865 15.978a.5.5 0 00.707.707l7.433-7.431 7.579 7.282a.501.501 0 00.846-.37.5.5 0 00-.153-.351L9.712 8.546l7.417-7.416a.5.5 0 10-.707-.708L8.991 7.853 1.413.573a.5.5 0 10-.693.72l7.563 7.268-7.418 7.417z" fill="currentColor">
    </svg>
  </div>
  <div class="info-bar">CHOOSE 1 FREE GIFT BELOW</div>
  <div class="product-popup__holder">
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/TPP_Banner_C_v1copy_3.jpg?v=1668780084" alt="Titan 15W Wireless Turbo Charge Dock™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan 15W Wireless Turbo Charge Dock™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Rapid 15W Charge</div>
         <div class="js-scroll product-template__wrapper--content__features--name">No More Messy Wires</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Charges with case</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="37938985861298">Default Title (37938985861298)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="2598" doubly-currency-rsd="279531.7041297431" doubly-currency="RSD">2,795.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="6495" doubly-currency-rsd="698829.2603243578" doubly-currency="RSD">6,988.45 RSD</span></span>
         </div>
         <input data-product-name="titan-15w-wireless-fast-charging-dock" type="submit" data-quantity="1" class="js-variant-selector text-uppercase cursor-pointer" value="+ ADD TO KIT" data-variant-id="37938985861298">
      </div>
   </div>
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/TitanDualMountWirelessCarCharger.jpg?v=1658753247" alt="Titan Dual Mount Wireless Charger™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan Dual Mount Wireless Charger™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Charges With Case</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Wireless Charging</div>
         <div class="js-scroll product-template__wrapper--content__features--name">In Car or at Home</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="31439734767734">Default Title (31439734767734)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="3397" doubly-currency-rsd="365500.07656995277" doubly-currency="RSD">3,655.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="6794" doubly-currency-rsd="731000.1531399055" doubly-currency="RSD">7,310.45 RSD</span></span>
         </div>
         <input data-product-name="titan-wireless-car-charging-holder" type="submit" data-quantity="1" class="js-variant-selector text-uppercase cursor-pointer" value="+ ADD TO KIT" data-variant-id="31439734767734">
      </div>
   </div>
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/titan-3-in-1-multi-cable-182652.jpg?v=1649946022" alt="Titan 3-in-1 Multi Cable™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan 3-in-1 Multi Cable™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Changeable Length</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Charge Any Device</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Retractable Cable</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="32022846799990">Default Title (32022846799990)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="2797" doubly-currency-rsd="300943.1010203585" doubly-currency="RSD">3,009.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="7991" doubly-currency-rsd="859791.3193613461" doubly-currency="RSD">8,597.45 RSD</span></span>
         </div>
         <input data-product-name="titan-3-in-1-multi-cable" type="submit" data-quantity="1" class="js-variant-selector text-uppercase cursor-pointer" value="+ ADD TO KIT" data-variant-id="32022846799990">
      </div>
   </div>
</div>
  <div class="product-template__wrapper--content__form--atc bundle-wrapper__buttonAdd">
    <button class="js-add-to-cart-popup f aic jcc w100 bg-titan-green font-sans btn--add-to-cart color-white">
      <div id="addToCartText-template--16118178119858__f9948fed-4ec6-468e-9bbf-3a4a75a5dd7f">FINISH KIT</div>
    </button>
  </div>
</div>
<div class="hero_image desktop">
  <img src="https://cdn05.zipify.com/YQYlWOcyp2ED2x0bfTtcYbXhcuw=/fit-in/3840x0/b84c767804c542d69e61df1b65dcc63d/patriot-package-banner.jpeg">
</div>
<div class="hero_image mobile">
  <img src="https://cdn05.zipify.com/YPhnQgvnN4hSneCvNAooYV44MVQ=/fit-in/540x0/f16a31dd06a04248a6b56f0d8aed5afe/bybuild-a-charging-kit-desktop-m.jpeg">
</div>
<div class="info-bar">ADD ANY 3 OR MORE AND CHOOSE 1 FREE GIFT BELOW</div>
<div class="bundle-wrapper offer-intro-wrapper">
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/TPP_Banner_C_v1copy_3.jpg?v=1668780084" alt="Titan 15W Wireless Turbo Charge Dock™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan 15W Wireless Turbo Charge Dock™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Rapid 15W Charge</div>
         <div class="js-scroll product-template__wrapper--content__features--name">No More Messy Wires</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Charges with case</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="37938985861298">Default Title (37938985861298)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="2598" doubly-currency-rsd="279531.7041297431" doubly-currency="RSD">2,795.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="6495" doubly-currency-rsd="698829.2603243578" doubly-currency="RSD">6,988.45 RSD</span></span>
         </div>
      </div>
   </div>
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/TitanDualMountWirelessCarCharger.jpg?v=1658753247" alt="Titan Dual Mount Wireless Charger™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan Dual Mount Wireless Charger™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Charges With Case</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Wireless Charging</div>
         <div class="js-scroll product-template__wrapper--content__features--name">In Car or at Home</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="31439734767734">Default Title (31439734767734)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="3397" doubly-currency-rsd="365500.07656995277" doubly-currency="RSD">3,655.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="6794" doubly-currency-rsd="731000.1531399055" doubly-currency="RSD">7,310.45 RSD</span></span>
         </div>
      </div>
   </div>
   <div class="bundle-wrapper__product">
      <div class="bundle-wrapper__product--image">
         <img src="//titanpowerplus.com/cdn/shop/products/titan-3-in-1-multi-cable-182652.jpg?v=1649946022" alt="Titan 3-in-1 Multi Cable™ - Titan Power Plus" loading="lazy">
      </div>
      <div class="bundle-wrapper__product--title">Titan 3-in-1 Multi Cable™</div>
      <div class="product-template__wrapper--content__features font-sans">
         <div class="js-scroll product-template__wrapper--content__features--name">Changeable Length</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Charge Any Device</div>
         <div class="js-scroll product-template__wrapper--content__features--name">Retractable Cable</div>
      </div>
      <div class="hidden">[{"name":"Title","position":1,"values":["Default Title"]}]</div>
      <select hidden="" name="id" id="ProductSelect">
         <option value="32022846799990">Default Title (32022846799990)</option>
      </select>
      <div class="bundle-wrapper__footer">
         <div class="js-price price type--m">
            <span class="js-price "><span class="money" doubly-currency-usd="2797" doubly-currency-rsd="300943.1010203585" doubly-currency="RSD">3,009.45 RSD</span></span>
            <span class="js-red-price crossed titan-red"><span class="money" doubly-currency-usd="7991" doubly-currency-rsd="859791.3193613461" doubly-currency="RSD">8,597.45 RSD</span></span>
         </div>
      </div>
   </div>
</div>
<div class="intro">
  <div class="intro__title">GRAB OVER 50% RRP OFF ALL ITEMS BELOW AND CHOOSE YOUR FREE GIFT FROM THE POP UP</div>
  <div class="intro__subtitle">Don't want 3 options? Just head to the cart with the FINISH KIT button at the bottom of the page.</div>
</div>
<div class="sticky-div w-100">
  <div class="js-info-bar">ADD 3 MORE AND PICK 1 FREE</div>
  <div class="progress">
    <div class="bar"></div>
  </div>
</div>
<div class="bundle-wrapper">
    {% render 'product-render' product_var:'3-x-titan-pd-cable™-black-friday'%}
    {% render 'product-render' product_var:'3-x-titan-smart-cable™'%}
    {% render 'product-render' product_var:'2x-titan-portable-wireless-3-in-1-charger™' tick1: '3 Devices At Once' tick2:'Super Compact' tick3:'Wireless Charge Buds' %}
    {% render 'product-render' product_var:'the-titan-buds-bundle-offer' tick1: 'Unbeatable Comfort' tick2:'Supreme Audio' tick3:'Wireless Charging'%}
    {% render 'product-render' product_var:'titan-magnetic-wireless-power-bank-bundle-offer-1' tick1: 'Wireless Charge' tick2:'Magnetic holder' tick3:'10,000mAh capacity' %}
    {% render 'product-render' product_var:'titan-3-in-1-mothership-dock™' tick1: 'No more messy wires' tick2:'15W Wireless Charge' tick3:'Charge 3 Devices' %}
    {% render 'product-render' product_var:'1-pd-cable-pd-bluetooth-car-charger™' tick1: 'In-car Phone Audio' tick2:'Handsfree calls' tick3:'Rapid PD Charging'%}
    {% render 'product-render' product_var:'pd-cable-45-plug' tick1: 'Changeable Length' tick2:'Charge Any Device' tick3:'Retractable Cable'%}
    
</div>

<div class="product-template__wrapper--content__form--atc bundle-wrapper__buttonAdd">
    <button class="js-add-to-cart f aic jcc w100 bg-titan-green font-sans btn--add-to-cart color-white">
      <div id="addToCartText-template--16118178119858__f9948fed-4ec6-468e-9bbf-3a4a75a5dd7f">FINISH KIT</div>
    </button>
</div>


<script>
const pos = document.querySelectorAll('.po')
const titleArray = []
let optionNames = document.querySelectorAll('.js-option-name')
const popUpControler = document.querySelector('.product-popup__wrapper')
const close = document.querySelector('.close')
close.addEventListener('click', (e) => {
  popUpControler.classList.toggle('hidden')
  body.classList.toggle('overflow-hidden')
})

pos.forEach((po) => {
  const name = po.getAttribute('data-value')
  const position = po.getAttribute('data-position')
  titleArray[position] = name
  po.addEventListener('click', (e) => {
    let variantName = ''
    const _this = e.target
    const divSelector = _this.parentNode.parentNode.parentNode.parentNode
    const parentSelector = divSelector.parentNode
    const siblings = _this.parentNode.parentNode.children
    console.log(siblings, 'RODJACI')
    for (let i = 0; i < siblings.length; i++) {
      siblings[i].classList.remove('active')
    }
    _this.parentNode.classList.add('active')
    const position = _this.getAttribute('data-position')
    const name = _this.getAttribute('data-value')
    const nameSelector = _this.parentNode.parentNode.parentNode
    const variantSelector = _this.parentNode.parentNode
    let setOptionName = nameSelector.querySelector('.js-option-name')
    variantSelector.classList.remove('open')
    setOptionName.innerHTML = name
    console.log(nameSelector, name, 'NAME')
    const active = parentSelector.querySelectorAll('.active')
    console.log(active, 'ACTIVE')
    if (active.length > 1) {
      console.log('VISE OD 1')
      for (let i = 0; i < active.length; i++) {
        const name = active[i].getAttribute('data-value')
        const position = active[i].getAttribute('data-position')
        titleArray[position] = name
      }
    } else {
      console.log('SAMO 1')
      titleArray[position] = name
    }
    console.log(titleArray, 'titleArray')

    console.log(titleArray, 'titleArray')
    for (let i = 0; i < titleArray.length; i++) {
      variantName += `${titleArray[i]} / `
    }
    const variantSelectorName = variantName.slice(0, -3)
    const selectedVariant = divSelector.querySelector(`[data-title="${variantSelectorName}"]`)
    console.log(variantSelectorName, selectedVariant)
    const selectedVariantId = selectedVariant.getAttribute('data-variant')
    const selectedVariantPrice = selectedVariant.getAttribute('data-price')
    const selectedVariantComparePrice = selectedVariant.getAttribute('data-compare-price')
    const buttonSelector = divSelector.querySelector('.js-variant-selector')
    const priceSelector = divSelector.querySelector('.js-price')
    const comparePriceSelector = divSelector.querySelector('.js-red-price')
    buttonSelector.setAttribute('data-variant-id', selectedVariantId)
    priceSelector.innerHTML = selectedVariantPrice
    comparePriceSelector.innerHTML = selectedVariantComparePrice
    console.log('selectedVariantId', selectedVariantId)
    console.log(titleArray, 'titleArray')
  })
})
const addToCart = document.querySelector('.js-add-to-cart')
const addToCartCheckout = document.querySelector('.js-add-to-cart-popup')
let addItems = () => {
  const variantsPickers = document.querySelectorAll('.js-variant-selector.selected')
  const productIds = []
  const addItems = []
  variantsPickers.forEach((variantsPicker) => {
    productIds.push(variantsPicker.getAttribute('data-variant-id'))
  })
  console.log(productIds, 'productIds')
  productIds.forEach((productId) => {
    const item = {
      id: productId,
      quantity: 1
    }
    addItems.push(item)
  })
  console.log(addItems, 'addItems')
  const formData = {
    items: addItems
  }
  fetch(window.Shopify.routes.root + 'cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
    .then(response => {
      return response.json()
    })
    .catch((error) => {
      console.error('Error:', error)
    })
}
let addItemsCheckout = () => {
  const variantsPickers = document.querySelectorAll('.js-variant-selector.selected')
  const productIds = []
  const addItems = []
  variantsPickers.forEach((variantsPicker) => {
    productIds.push(variantsPicker.getAttribute('data-variant-id'))
  })
  console.log(productIds, 'productIds')
  productIds.forEach((productId) => {
    const item = {
      id: productId,
      quantity: 1
    }
    addItems.push(item)
  })
  console.log(addItems, 'addItems')
  const formData = {
    items: addItems
  }
  fetch(window.Shopify.routes.root + 'cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
    .then(response => {
      if (response.status === 200) {
        window.location.href = '/checkout'
      }
      return response.json()
    })
    .catch((error) => {
      console.error('Error:', error)
    })
}
addToCart.addEventListener('click', (e) => {
  let numberOfSelected = document.querySelectorAll('.js-variant-selector.selected').length
  if(numberOfSelected < 3) {
      addItems()
  } else {
    popUpControler.classList.toggle('hidden')
    body.classList.toggle('overflow-hidden')
  }
})
addToCartCheckout.addEventListener('click', (e) => {
  addItemsCheckout()
})
const infoBar = document.querySelector('.js-info-bar')
const variantClicks = document.querySelectorAll('.js-variant-selector')
variantClicks.forEach(variantClick => {
    variantClick.addEventListener('click', (e) => {
        const bar = document.querySelector(".bar");
        console.log('click')
        const _this = e.target
        _this.closest(".bundle-wrapper__product").classList.toggle('selected');
        if(_this.value === 'added') {
            _this.classList.remove('selected')
            _this.value = '+ add to kit'
            let numberOfSelected = document.querySelectorAll('.js-variant-selector.selected').length
            let leftToGift = 3 - numberOfSelected;
            console.log(leftToGift,'leftToGift')
            if(leftToGift <= 0) {
                infoBar.innerHTML = `YOU UNLOCKED 1 FREE GIFT! CLICK FINISH KIT TO CLAIM IT !`
                bar.style.setProperty("--progress", "100%");
                return
            }
            infoBar.innerHTML = `ADD ${leftToGift} MORE AND GET 1 FREE`
            if(leftToGift === 1) {
                bar.style.setProperty("--progress", "66%");
            }
            if(leftToGift === 2) {
                bar.style.setProperty("--progress", "33%");
            }
            if(leftToGift === 3) {
                bar.style.setProperty("--progress", "0%");
            }
            return
        }
        _this.classList.add('selected')
        _this.value = 'added'
        let numberOfSelected = document.querySelectorAll('.js-variant-selector.selected').length
        let leftToGift = 3 - numberOfSelected;
        if(leftToGift <= 0) {
            infoBar.innerHTML = `YOU UNLOCKED 1 FREE GIFT! FINISH KIT TO CLAIM IT !`
            bar.style.setProperty("--progress", "100%");
            return
        }
        infoBar.innerHTML = `ADD ${leftToGift} MORE AND GET 1 FREE`
        if(leftToGift === 1) {
            bar.style.setProperty("--progress", "66%");
        }
        if(leftToGift === 2) {
            bar.style.setProperty("--progress", "33%");
        }
        if(leftToGift === 3) {
                bar.style.setProperty("--progress", "0%");
        }
        console.log(leftToGift, numberOfSelected, 'numberOfSelected')
    })
});

console.log(optionNames, 'optionNames')
optionNames.forEach((optionName) => {
    optionName.addEventListener('click', (e) => {
        const _this = e.target
        _this.nextSibling.nextSibling.classList.toggle('open');
    })
}) 
{% comment %} stickyElem = document.querySelector(".sticky-div");
currStickyPos = stickyElem.getBoundingClientRect().top + window.pageYOffset;
var lastScrollTop = 0;
    $(window).scroll(function(event){
      var st = $(this).scrollTop();
        if (st > lastScrollTop){
            if(window.pageYOffset > currStickyPos) {
                stickyElem.style.position = "fixed";
                stickyElem.style.top = "60px";
                stickyElem.classList.add('sticky');
            } else {
                stickyElem.style.position = "relative";
                stickyElem.style.top = "0px";
                stickyElem.classList.remove('sticky');
            }
        } else {
            if(window.pageYOffset > currStickyPos) {
                stickyElem.style.position = "fixed";
                stickyElem.style.top = "60px";
                stickyElem.classList.add('sticky');
            } else {
                stickyElem.style.position = "relative";
                stickyElem.style.top = "0px";
                stickyElem.classList.remove('sticky');
            }
        }
        lastScrollTop = st;
    }); {% endcomment %}
</script>